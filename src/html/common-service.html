<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <title>联系客服</title>
    <link rel="stylesheet" href="../css/dropload.css">
    <link rel="stylesheet" href="../css/layer.css">
    <link rel="stylesheet" href="../css/common-service.css">
    <script>
        !function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window;t["default"]=i.flex=function(e,t){var a=e||100,n=t||1,r=i.document,o=navigator.userAgent,d=o.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i),l=o.match(/U3\/((\d+|\.){5,})/i),c=l&&parseInt(l[1].split(".").join(""),10)>=80,p=navigator.appVersion.match(/(iphone|ipad|ipod)/gi),s=i.devicePixelRatio||1;p||d&&d[1]>534||c||(s=1);var u=1/s,m=r.querySelector('meta[name="viewport"]');m||(m=r.createElement("meta"),m.setAttribute("name","viewport"),r.head.appendChild(m)),m.setAttribute("content","width=device-width,user-scalable=no,initial-scale="+u+",maximum-scale="+u+",minimum-scale="+u+",user-scalable=no,viewport-fit=cover"),r.documentElement.style.fontSize=a/2*s*n+"px"},e.exports=t["default"]}]);
        flex(100, 1);
    </script>
</head>
<body>
    <div class="service-warp">
        <div class="mineService-container">
            <div class="mineService-main">
                <div class="chat-detail-list">
                    <ul class="mineService-ul">
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list chart-mine">
                                <div class="chart-user">
                                    <img src="" alt="">
                                </div>
                                <div class="chart-text">
                                    <p>灵敏</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list">
                                <div class="chart-user">
                                    <img class="system-img" src="../images/system-img.png" alt="">
                                </div>
                                <div class="chart-text">
                                    <p>你好，很高兴为你服务!请问有什么可以帮到你，没事不要q 我</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list chart-mine">
                                <div class="chart-user">
                                    <img src="" alt="">
                                </div>
                                <div class="chart-text">
                                    <p><img src="http://192.168.101.112:3333/web-app-vw-for-xyc/dist/images/mmexport1540270131194.jpg" alt=""></p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list">
                                <div class="chart-user">
                                    <img class="system-img" src="../images/system-img.png" alt="">
                                </div>
                                <div class="chart-text">
                                    <p><img src="http://192.168.101.112:3333/web-app-vw-for-xyc/dist/images/mmexport1540270131194.jpg" alt=""></p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list chart-mine">
                                <div class="chart-user">
                                    <img src="" alt="">
                                </div>
                                <div class="chart-text">
                                    <p>撒大卡的撒啦啦啦啦啦啦啦啦啦啦啦啦啦啦   撒扩大水水水水水水水水水水水水水水水水</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="chart-system">
                                <span>2019-03-19 09:24</span>
                            </div>
                            <div class="chart-list chart-mine">
                                <div class="chart-user">
                                    <img src="" alt="">
                                </div>
                                <div class="chart-text">
                                    <p>撒大卡的撒啦啦啦啦啦啦啦啦啦啦啦啦啦啦   撒扩大水水水水水水水水水水水水水水水水</p>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mineService-btn">
                <div class="user-comment">
                    <div class="user-input-icon">
                        <div class="icon-warp">
                            <i class="icon-camera"></i>
                        </div>
                        <form action="" class="user-form">
                            <input type="hidden" name="1234">
                            <input type="hidden" name="4321">
                            <input type="file" name="121212" multiple="multiple" accept="image/*">
                        </form>
                    </div>
                    <div class="user-input-hold">
                        <div class="user-input-hold-in">
                            <!--实现输入框自定义-->
                            <pre class="userPre" id="userPre"><span></span></pre>
                            <textarea typeof="submit" class="input-holder" id="userInput" placeholder="请输入你的问题"></textarea>
                            <!--<div class="input-holder">请输入你的问题</div>-->
                        </div>
                    </div>
                    <div class="user-send-btn">
                        <button class="send-btn-text" disabled id="sendBtn">发送</button>
                    </div>
                </div>
            </div>
            <!--<div class="comment-popup">-->
                <!--<div class="comment-popup-inner">-->
                    <!--<div class="user-text">-->
                        <!--<textarea name="userInput" class="userInput" cols="30" rows="10" placeholder="请输入你的问题..."></textarea>-->
                    <!--</div>-->
                    <!--<div class="comment-btn">-->
                        <!--<div class="comment-btn-item">-->
                            <!--<button class="sure">提交</button>-->
                        <!--</div>-->
                        <!--<div class="comment-btn-item">-->
                            <!--<button class="cancel">取消</button>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
    </div>

    <script src="../js/lib/jquery-1.8.3.min.js"></script>
    <script src="../js/lib/fastclick.js"></script>
    <script src="../js/lib/layer.js"></script>
    <script src="../js/lib/dropload.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
    <script>

        //初始化调用
        document.body.scrollTop = document.body.scrollHeight;

        /**点击显示图片大图*/
        $(".mineService-main").on("click", ".chart-text img", function () {
            console.log($(this).attr("src"))
            var src = $(this).attr("src");
            console.log(src)
            var imgs = [];
            imgs.push(src)
            WeixinJSBridge.invoke("imagePreview", {
                current: src, // 当前显示图片的http链接
                urls: imgs // 需要预览的图片http链接列表
            });
        })

        console.log($(".mineService-main ul .chart-text p img").complete)
        // $(".mineService-main ul .chart-text p img").complete = function(){
        //
        // }

        scrollToBottom();

        //滚动到最底部(更新列表调用一次)
        function scrollToBottom() {
            var targetEle = $('.mineService-main .chat-detail-list');
            console.warn("获取到的高度", targetEle[0].scrollHeight)
            //targetEle[0].scrollHeight
            targetEle.scrollTop(targetEle[0].scrollHeight)
        }

        // $(".mineService-main").on("touchmove", function () {
        //     console.log("我华东了")
        //     $("#userInput").blur()
        // })

        //输入框监听
        $("#userInput").on("input propertychange", function () {
            var result = $(this).val();
            if(result){
                $("#userPre span").html(result)
                $(".send-btn-text").attr("disabled", false)
            }else {
                $(".send-btn-text").attr("disabled", true)
                $("#userPre span").html('')
            }

        })
        var timer;
        $("#userInput").focus(function (e) {
            scrollToBottom();
            timer = setInterval(
                function () {
                    document.body.scrollTop = document.body.scrollHeight
                }, 100
            )
        }).blur(function () {
            // scrollToBottom();
            document.body.scrollTop = document.body.scrollHeight
            clearInterval(timer)
        })


        $("#showText").on("click", function () {
            var pageii = layer.open({
                type: 1
                ,className: 'showText-warp'
                ,content: $(".comment-popup").html()
                ,anim: 'up'
                ,style: 'position:fixed; left:0; top:0; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;'
                ,success: function (ele) {

                    //加载成功获取焦点
                    $(ele).find(".userInput").focus();
                    //点击提交
                    $(ele).on("click", "button.sure", function () {
                        var userInput = $(ele).find(".userInput").val()
                        console.log("userInput", userInput)
                        layer.closeAll()
                    })
                    //点击取消
                    $(ele).on("click", "button.cancel", function () {
                        layer.closeAll()
                    })

                }
            });
        })

        //下拉加载更多

        // dropload
        var dropload = $('.chat-detail-list').dropload({
            domUp : {
                domClass   : 'dropload-up',
                domRefresh : '<div class="dropload-refresh">下拉查看更多信息</div>',
                domUpdate  : '<div class="dropload-update">↑释放加载更多</div>',
                domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中...</div>'
            },
            loadUpFn : function(me){
                $.ajax({
                    type: 'GET',
                    url: './more.json',
                    dataType: 'json',
                    success: function(data){
                        var result = '';
                        for(var i = 0; i < data.lists.length; i++){
                            result += "<li>" +
                                "<div class='chart-system'>" +
                                    "<span>2019-03-19 09:24</span>" +
                                "</div>" +
                                "<div class='chart-list chart-mine'>" +
                                    "<div class='chart-user'>" +
                                        "<img src='' alt=''>" +
                                    "</div>" +
                                    "<div class='chart-text'>" +
                                        "<p>"+ data.lists[i].title +"</p>" +
                                    "</div>" +
                                "</div>" +
                                "</li>";

                            if((i + 1) >= data.lists.length){
                                // 锁定- 没有更多数据时调用
                                dropload.lock();
                                break;
                            }
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function(){
                            $(".mineService-ul").prepend(result);
                            // 每次数据加载完，必须重置
                            me.resetload();
                            // 重置索引值，重新拼接more.json数据
                            // counter = 0;
                            // 解锁
                            // me.unlock();
                            // me.noData(false);
                        },1000);
                    },
                    error: function(xhr, type){
                        console.log('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
            }
        });

        
        $("#sendBtn").on("click", function () {
            $(".mineService-main ul").append("<li>\n" +
                "                        <div class=\"chart-system\">\n" +
                "                            <span>2019-03-19 09:24</span>\n" +
                "                        </div>\n" +
                "                        <div class=\"chart-list chart-mine\">\n" +
                "                            <div class=\"chart-user\">\n" +
                "                                <img src=\"\" alt=\"\">\n" +
                "                            </div>\n" +
                "                            <div class=\"chart-text\">\n" +
                "                                <p>我是测试数据</p>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                    </li>");

            scrollToBottom();
        })





    </script>
</body>
</html>